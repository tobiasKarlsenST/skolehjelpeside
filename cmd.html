<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="styles.css">
        <title>CMD - Hjelpeside for IT Strand</title>
        <script src="navbar.js" defer></script>

        
    </head>
    <body>
        <img class="background"src="https://thenordicnomad.com/wp-content/uploads/2023/01/TNN_Preikestolen_Rogaland_Norway_01_.jpg"/>
        <header id="navbar-placeholder"></header>
        <div class="content">
            <div class="top">
                <h1>CMD/PowerShell Commands</h1>
                <button id="resetCache">Refresh</button>
            </div>
            <p><strong>Kj√∏r CMD som administrator!</strong></p>

            
            <div id="cmd-container"></div>
        </div>
        <script>
            const sheetUrl = "https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLgcb8v34c0trkkbtKD9o8fOdR9z0QWVQ5_A8Cg0ZpzHNyXx08H-Oyw7XTKxEw--ejVk9kWUXkUBRe6s_w-hNHbgTgvdquVKQiYQT5X0H5ciK0wLC7Uv9wfOoIyc3dFbwzeAIRVr8AK0tqvgHpvT1VYrV755u7gyaKSwwThTub0MvmvsPEf0wxMIHRm8EJt0cW9mWjs-yx0isoiAuWWd3nZXr_FJP9Mtfblu3lYGLWAqITgUEUVC_564-RzIf6LtdJDBa6uA5AGARkp3NNkL02wIEHHryQ&lib=MoPesbO-_SN0qATgGoC6Hbu_f9Eepb8L8";
        
            async function loadCommands() {
                const cached = localStorage.getItem('cmdData');
                let data;

                if (cached) {
                    console.log("using cached data");
                    data = JSON.parse(cached);
                }else{
                    console.log("fetching data")
                    const res = await fetch(sheetUrl);
                    data = await res.json();
                    console.log("Saving to localStorage:", data);
                    localStorage.setItem('cmdData', JSON.stringify(data));
                }
                
                renderTable(data);

            }

            function renderTable(data){
                const container = document.getElementById("cmd-container")

                // Grupper etter kategori
                const categories = {};
                data.forEach(item => {
                    if (!categories[item.Kategori]) categories[item.Kategori] = [];
                    categories[item.Kategori].push(item);
                });


                let fullHTML = '';
                for (const category in categories) {
                    const items = categories[category];

                    fullHTML += `<table>
                                    <tbody>
                                        <tr>
                                            <td colspan="2" style="padding:0;">
                                                <div class="tableHeading">${category}</div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="tableUnderHeadings"><strong>Command</strong></td>
                                            <td class="tableUnderHeadings"><strong>Beskrivelse</strong></td>
                                        </tr>`;

                    items.forEach(cmd => {
                        fullHTML += `<tr class="tableContent">
                                    <td><div class="lenker">${cmd.Command}</div></td>
                                    <td>${cmd.Beskrivelse}</td>
                                </tr>`;
                    });

                    fullHTML += `</tbody></table><br>`;
                    
                }

                container.innerHTML += fullHTML;

                // Copy-click
                document.querySelectorAll(".lenker").forEach(cmd => {
                    cmd.addEventListener("click", () => {
                        navigator.clipboard.writeText(cmd.textContent);
                        const original = cmd.textContent;
                        cmd.textContent = "Kopiert!";
                        setTimeout(() => cmd.textContent = original, 1000);
                    });
                });
            }
            loadCommands();
            document.getElementById("resetCache").addEventListener("click", () => {
                localStorage.removeItem("cmdData");
                location.reload();
                console.log("refesh")
            })
        </script>
    </body>
</html>